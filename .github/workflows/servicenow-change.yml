
name: ServiceNow DevOps Change (Token)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  ServiceNowDevOpsChange:
    needs: build
    runs-on: ubuntu-latest
    name: 'ServiceNow DevOps Change'
    steps:
      - name: ServiceNow Change
        uses: ServiceNow/servicenow-devops-change@v6.1.0
        with:
          devops-integration-token: ${{ secrets.SN_DEVOPS_INTEGRATION_TOKEN }}
          instance-url: ${{ secrets.SN_INSTANCE_URL }}
          tool-id: ${{ secrets.SN_ORCHESTRATION_TOOL_ID }}
          context-github: ${{ toJSON(github) }}
          job-name: 'ServiceNow DevOps Change'
          change-request: |
            {
              "attributes": {
                "short_description": "Automated Deployment",
                "description": "Create DevOps change from GitHub Actions",
                "category": "DevOps",
                "implementation_plan": "Automated deploy within approved window",
                "backout_plan": "Redeploy previous version",
                "test_plan": "Post-deploy smoke tests"
              }
            }
``
